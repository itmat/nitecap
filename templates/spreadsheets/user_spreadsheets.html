{% extends "base.html" %}
{% block content %}

<script>

    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    });

    $(document).ready(function() {
        $('#spreadsheetTable').DataTable();
    });

</script>

<div class="page-header">
    <h1>Saved Spreadsheets</h1>
</div>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="badge badge-info">Notes</div>
        <div class="server-notes">
            {% for message in messages %}
                <div>{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

{% if errors %}
    <div class="badge badge-danger">Errors</div>
    <div class="server-errors">
        {% for error in errors %}
            <div>{{error}}</div>
        {% endfor %}
    </div>
{% endif %}


{% if user.spreadsheets %}
    <table id="spreadsheetTable" class="table table-striped table-bordered" width="100%">
        <thead>
            <tr>
                <th>Uploaded File</th>
                <th>Date Uploaded</th>
                <th>Name</th>
                <th>Days</th>
                <th>Timepoints</th>
                <th>Breakpoint</th>
                <th>Processed File</th>
                <th>Last Update</th>
                <th> </th>
            </tr>
        </thead>
        <tbody>
        {% for spreadsheet in user.spreadsheets %}
            {% if spreadsheet.error %}
                <tr class="alert alert-danger" role="alert">
                    {% else %}
                <tr>
            {% endif %}
                <td>
                    {{spreadsheet.original_filename}}
                    &nbsp;&nbsp;
                    <a href="{{ url_for('spreadsheets.edit_details', spreadsheet_id = spreadsheet.id) }}">
                        <i class="fas fa-edit" data-toggle="tooltip" data-placement="top" title="Edit"></i>
                    </a>
                </td>
                <td>{{spreadsheet.date_uploaded.strftime("%d%b%Y, %H:%M") }}</td>
                <td>{{spreadsheet.descriptive_name}}</td>
                <td>{{spreadsheet.days}}</td>
                <td>{{spreadsheet.timepoints}}</td>
                <td>{{spreadsheet.breakpoint}}</td>
                <td>
                    <a href="{{ url_for('spreadsheets.show_spreadsheet', spreadsheet_id = spreadsheet.id) }}">
                        <i class="fas fa-eye" data-toggle="tooltip" data-placement="top" title="View graphs"></i>
                    </a>
                    &nbsp;&nbsp;
                    <a href="{{ url_for('spreadsheets.download', spreadsheet_id = spreadsheet.id) }}"
                       download="processed_file_{{spreadsheet.id}}.txt">
                        <i class="fas fa-download" data-toggle="tooltip" data-placement="top" title="Download"></i>
                    </a>
                </td>
                <td>{{spreadsheet.last_access.strftime("%d%b%Y, %H:%M") }}</td>
                <td><a href="{{ url_for('spreadsheets.delete', spreadsheet_id = spreadsheet.id) }}">
                    <i class="fas fa-trash" data-toggle="tooltip" data-placement="top" title="Delete"></i>
                </a></td>
            </tr>
        {% endfor %}
        </tbody>
        <!--
        <tfoot>
            <tr>
                <td>Uploaded File</td>
                <td>Date Uploaded</td>
                <td>Name</td>
                <td>Days</td>
                <td>Timepoints</td>
                <td>Breakpoint</td>
                <td>Processed File</td>
                <td>Last Update</td>
                <td> </td>
            </tr>
        </tfoot>
        -->
    </table>
{% endif %}

{% endblock %}