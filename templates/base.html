<!DOCTYPE html>
<html lang="en">
<head>
    <script>console.log("{{ config['ENV'] }}")</script>
    {% if config['ENV'] == 'production' %}
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138419827-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-138419827-1');
        </script>
    {%  endif %}

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Nitecap</title>
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" />
    <link rel="stylesheet" href="https://getbootstrap.com/docs/4.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.0/css/select.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}?v=3" />
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>
    <script src="{{ url_for('static', filename='js/moment.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}?v=4"></script>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="{{url_for('home')}}">
            <img src="{{ url_for('static', filename='images/nitecap_logo.svg') }}" alt="NITECAP logo" height="100px">
        </a>
        <button class="navbar-toggler" type="button"
                data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="navbarNav" class="navbar-collapse collapse">
            <ul class="nav navbar-nav mr-auto">
                <li class="nav-item"><a class="nav-link" href="{{url_for('spreadsheets.upload_file')}}">Load Spreadsheet</a></li>
                {% if 'email' in session and session['email'] and 'visitor' in session and not session['visitor'] %}
                    <li class="nav-item"><a class="nav-link" href="{{url_for('spreadsheets.display_spreadsheets')}}">Display Spreadsheets</a></li>
                {% endif %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('faqs') }}">FAQ</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('people') }}">People</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('about') }}">About</a></li>
            </ul>
            <ul class="nav navbar-nav ml-auto align-items-center">
                {% if not session['email'] or 'visitor' not in session or session['visitor'] %}
                    <li class="nav-item"><a class="nav-link" href="{{url_for('users.register_user') }}">Register</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{url_for('users.login_user', next=request.path ) }}">Login</a></li>
                {% else %}
                    {% if session['email'] in config.ADMIN_LIST and not session['visitor'] %}
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a></li>
                    {% endif %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('users.update_profile') }}">Profile for {{ session['email'] }}</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{url_for('users.logout_user') }}">Logout</a></li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link" href="http://www.itmat.upenn.edu">
                        <img src="{{ url_for('static', filename='images/itmat_logo.svg') }}" alt="ITMAT logo" height=75px>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</div>

<div class="content container">
    {# Maintenance Banner - set display:block to show banner #}
    <div id="nitecap_banner" class='alert-warning alert' role="alert"
         style={{ "display:block" if config['BANNER_VISIBLE'] else "display:none" }}>
        {{ config['BANNER_CONTENT'] }}
    </div>
    {% block content %}
    {% endblock %}
</div>

<script>
     $(document).ready(function() {
         let feedback_link = $("#feedback_link");
         let feedback_modal = $("#feedback-modal");
         let feedback_form = $("#feedback_form");
         let feedback_submit = $("#feedback_submit");
         let feedback_acknowledgement = $("#feedback_acknowledgement");
         let feedback_failure = $("#feedback_failure");
         let comments = $("#comments");

         feedback_link.on('click', function() {
             feedback_form.show();
             comments.val("");
             feedback_submit.show();
             feedback_acknowledgement.hide();
             feedback_failure.hide();
             feedback_modal.modal();
         });

         feedback_submit.on('click', function() {

            $.ajax({
                type: 'POST',
                url: "{{ url_for('send_feedback') }}",
                data: JSON.stringify({"comments": comments.val()}),
                dataType: "json",
                contentType: "application/json",
                success: function(response) {
                    console.log($.trim(comments.val()).length);
                    if($.trim(comments.val()).length > 0) {
                        feedback_form.hide();
                        feedback_submit.hide();
                        feedback_acknowledgement.show();
                    }
                    else {
                        feedback_modal.modal("hide");
                    }
                },
                error: function(request) {
                    let error_message = $.parseJSON(request.responseText).error;
                    feedback_form.hide();
                    feedback_submit.hide();
                    feedback_failure.html(error_message);
                    feedback_failure.show();
                },
            });
         });

     });
</script>

<!-- Feedback Modal -->
<div class="modal fade" id="feedback-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="model-title text-white">Feedback</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span class="text-white" aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div id="feedback_form" class="form-group">
                    <label for="comments">
                        Please inform us of any issues you have and/or how we might improve your experience with
                        our website:
                    </label>
                    <textarea id="comments" name="comments" class="form-control" rows="5" cols="50"></textarea>
                </div>
                <div id="feedback_acknowledgement">Thank you for your feedback!</div>
                <div id="feedback_failure" class="text-danger"></div>
            </div>
            <div class="modal-footer">
                <button type="button" id="feedback_submit" class="btn btn-primary">
                    <span aria-hidden="true">Submit</span>
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Dismiss</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger">
                <h5 class="model-title text-white">Error</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span class="text-white" aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="error-modal-message" class="modal-body text-danger">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Dismiss</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Sticky footer -->
<footer class="footer">
      <div class="container">
          <div class="row">
              <div class="col-lg-5 text-muted">
                  <small>Copyright
                    <span class="px-1" id="copyrightYear"></span>&copy;
                    <a href="http://www.itmat.upenn.edu/" target="_blank">ITMAT</a>
                    All rights reserved
                  </small>
              </div>
              <div class="col-lg-2 text-muted">
                  <a id="feedback_link" class="text-primary" style="cursor:pointer"><small>Feedback?</small></a>
              </div>
              <div class="col-lg-5 text-muted text-right">
                  <a href="mailto:admin@nitecap.org">
                      <i class="fa fa-envelope" aria-hidden="true"></i>
                      <small class="pl-2">admin@nitecap.org</small>
                  </a>
              </div>
          </div>
      </div>
</footer>

</body>
</html>
